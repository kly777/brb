# 事件管理系统设计文档

## 概述

本系统旨在对个人或团队的任务管理进行结构化建模，区分 **事件（Event）**、**任务（Task）** 和 **待办项（Todo）** 三个层级，支持模板复用、时间规律生成、依赖关系、优先级管理等功能。

---

## 核心概念

### 1. 事件（Event）

`Event` 是对一类活动的抽象描述，不包含具体时间信息，可作为创建 `Task` 的模板。
一个 `Event` 可以生成多个相关的 `Task`。

#### 字段说明

| 字段名        | 类型           | 说明                                       |
| ------------- | -------------- | ------------------------------------------ |
| `is_template` | Boolean        | 是否为模板事件（可用于批量创建周期性任务） |
| `title`       | String         | 事件标题                                   |
| `description` | String         | 详细描述                                   |
| `location`    | String         | 地点                                       |
| `priority`    | Integer / Enum | 自定义优先级（如：高、中、低）             |
| `category`    | String         | 分类标签（如：工作、生活、健康等）         |

> 💡 **用途示例**：
>
> - “每周健身” 可作为一个模板事件
> - “年度体检” 可作为非模板事件

---

### 2. 任务（Task）

`Task` 是从 `Event` 实例化的具体任务，具有明确的时间范围和状态，代表需要完成的一项工作。

#### 字段说明

| 字段名               | 类型             | 说明                                                  |
| -------------------- | ---------------- | ----------------------------------------------------- |
| `event`              | Reference(Event) | 所属事件（来源）                                      |
| `description`        | String           | 当前任务的具体描述（可在 Event 基础上定制）           |
| `due_window`         | TimeRange        | 执行期限（开始时间 ~ 截止时间），在此区间内需完成任务 |
| `parent_task`        | Reference(Task)  | 父任务（用于构建任务树结构）                          |
| `prerequisite_tasks` | List<Task>       | 前置任务列表（必须完成后才能开始当前任务）            |
| `status`             | Enum             | 状态：待定 / 进行中 / 完成                            |
| `created_at`         | DateTime         | 创建时间                                              |
| `completed_at`       | DateTime         | 实际完成时间（可选）                                  |

> ✅ **特点**：
>
> - 一个 `Event` 可生成多个 `Task`
> - 支持父子任务结构（分解大任务）
> - 支持前置依赖（拓扑排序执行）

---

### 3. 待办项（Todo）

`Todo` 是为了完成某个 `Task` 而划分出的具体行动步骤，表示在某段时间内持续执行的操作。

#### 字段说明

| 字段名             | 类型            | 说明                                           |
| ------------------ | --------------- | ---------------------------------------------- |
| `task`             | Reference(Task) | 所属任务                                       |
| `planned_duration` | TimeRange       | 计划执行时间段（例如：2025-04-05 14:00–15:00） |
| `actual_duration`  | TimeRange       | 实际执行时间段（完成后填写）                   |
| `status`           | Enum            | 状态：待定 / 进行中 / 完成                     |

> 🔄 **关系**：
>
> - 一个 `Task` 可包含多个 `Todo`
> - `Todo` 是最小执行单元，用于记录时间和进度

---

## 高级特性

### 1. 事件间的关联要素

某些事件之间存在**时间上的依赖关系**，例如：

- 上次理发时间 → 决定下次理发计划时间
- 上次锻炼时间 → 提醒下一次锻炼
- 设备保养周期基于上次维护时间

> 🔗 实现方式：
>
> - 在 `Event` 或 `Task` 中添加 `last_occurrence` 字段
> - 使用 `recurrence_rule` 自动推算下次时间

---

### 2. 模板机制（Template-based Creation）

通过设置 `is_template = true` 的 `Event`，可以作为模板创建实际任务。

#### 示例模板

```json
{
    "title": "周会",
    "description": "团队每周同步进展",
    "location": "会议室A / Zoom",
    "priority": "高",
    "category": "工作",
    "is_template": true
}
```

---

### 3. 规律性任务自动生成（Recurring Tasks）

基于模板事件，结合重复规则，可按规律自动创建 `Task`。

#### 支持的重复模式

| 类型               | 示例                   |
| ------------------ | ---------------------- |
| 每日               | 每天早上 8 点打卡      |
| 每周               | 每周一上午 10 点开例会 |
| 每月               | 每月第一个周六做总结   |
| 每 N 天            | 每 3 天浇一次花        |
| 自定义 Cron 表达式 | 高级用户使用           |

> ⚙️ 自动生成逻辑：
>
> - 启动定时器或每日扫描模板
> - 判断是否到达生成时间
> - 若未生成对应时间段的 `Task`，则自动创建

---

### 4. 多维度任务视图与排序

用户对不同事务有不同的主观判断，因此引入以下评估维度：

| 维度                    | 说明                                                           |
| ----------------------- | -------------------------------------------------------------- |
| **优先级（Priority）**  | 用户自定义重要程度（高/中/低 或 数值 1~5）                     |
| **紧急程度（Urgency）** | 系统根据 `due_window` 自动计算：<br>越接近截止日期，紧急度越高 |

> 📊 应用场景：
>
> - 四象限法则（重要 & 紧急）
> - 待办清单智能排序推荐

---

## 数据关系图（文字版）

```
[Event]
   │ is_template: true/false
   ↓ (实例化)
[Task] —— has many ——→ [Todo]
   │
   ├─ parent_task → [Task] (形成树形结构)
   └─ prerequisite_tasks → [Task] (依赖其他任务完成)

[Event A] ──┐
            ├──→ 多个 Task（如：每周一次）
[Event B] ──┘

[Task X] ──→ 多个 Todo（拆解为具体动作）
```

---

## 使用流程示例

### 场景：定期理发

1. 创建模板事件：

    ```text
    Event:
      title: 理发
      description: 剪发并清洁
      location: 小李理发店
      category: 生活
      is_template: true
      recurrence: every 28 days
    ```

2. 系统自动生成 Task：

    ```text
    Task #1:
      event: 理发
      due_window: 2025-04-01 ~ 2025-04-07
      status: 待定
    ```

3. 用户完成任务后，记录：

    ```text
    Todo #1:
      task: 去理发店剪发
      planned_duration: 2025-04-05 16:00–17:00
      actual_duration: 2025-04-05 16:10–16:50
      status: 完成
    ```

4. 更新最后发生时间，并触发下一次任务生成（+28 天）

---

## 总结

| 层级  | 作用                   | 是否有时序              | 是否可重复            |
| ----- | ---------------------- | ----------------------- | --------------------- |
| Event | 抽象事件定义，支持模板 | 否                      | 是（通过 recurrence） |
| Task  | 具体要完成的任务       | 是（有截止窗口）        | 否（单次实例）        |
| Todo  | 执行过程中的具体操作   | 是（计划 & 实际时间段） | 否                    |

✅ 优势：

- 结构清晰，层次分明
- 支持模板与周期任务自动化
- 支持复杂依赖与进度追踪
- 可扩展至团队协作与项目管理

---

> 📝 后续建议：
>
> - 引入日历视图展示 `Todo` 的时间分布
> - 添加提醒功能（临近 `due_window` 发送通知）
> - 支持导出模板库、分享常用 `Event`

---

📄 文档版本：v1.0  
📅 最后更新：2025-04-05
